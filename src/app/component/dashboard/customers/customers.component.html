<div *ngIf="loading" style="height: 90vh;">
  <div class="spinner loading"></div>
</div>

<div *ngIf="!loading && selectedUser === undefined" style="height: 100%">
  <kendo-grid *ngIf="language !== undefined" [data]="gridView" [style.height]="height" [resizable]="true"
    [pageSize]="state.take" [skip]="state.skip" [sort]="state.sort" [filter]="state.filter" [sortable]="true"
    [pageable]="pageable" (pageChange)="pageChange($event)" [kendoGridSelectBy]="mySelectionKey" [groupable]="true"
    [group]="state.group" [pageSize]="pageSize" (groupChange)="groupChange($event)">
    <kendo-grid-messages pagerPage="{{language.pagerPage}}" pagerOf="{{language.pagerOf}}"
      pagerItems="{{language.pagerItems}}" pagerItemsPerPage="{{language.pagerItemsPerPage}}">
    </kendo-grid-messages>
    <ng-template kendoGridToolbarTemplate>
      <div class="search">
        <kendo-textbox-container floatingLabel="{{language.searchAllColumn}}">
          <input kendoTextBox (input)="onFilter($event.target.value)" [(ngModel)]="searchFilter" />
        </kendo-textbox-container>
      </div>
      <div style="float: right; padding-right: 30px; padding-top: 14px;">
        <button kendoButton [icon]="'add'" (click)="newUser()" [primary]="true"
          style="background: #6673FC !important; margin-left: 12px;">{{language.newCustomer}}</button>
        <div class="dropdown-grid">
          <button class="btn-grid" style="border-left:1px solid #0d8bf2">
            <i class="fa fa-caret-down"></i>
          </button>
          <div class="dropdown-content-grid">
            <a style="padding: 0px;"><label class="uploadFromExcel-{{theme}}"
                style="padding: 12px; cursor: pointer;"><span class='k-icon k-i-file-excel'></span>
                {{ language.uploadFromExcel }}<input type="file" name="files[]" multiple id="jsonFile" accept=".xlsx"
                  (change)="onFileChange($event)" [(ngModel)]="fileValue" /></label></a>
            <a kendoGridPDFCommand><span class="k-icon k-i-file-pdf"></span> {{language.exportToPDF}}</a>
            <a kendoGridExcelCommand><span class="k-icon k-i-file-excel"></span> {{language.exportToExcel}}</a>
          </div>
        </div>
      </div>
    </ng-template>
    <kendo-grid-column field="shortname" title="{{language.username}}">
    </kendo-grid-column>
    <kendo-grid-column field="firstname" title="{{language.firstname}}">
    </kendo-grid-column>
    <kendo-grid-column field="lastname" title="{{language.lastname}}">
    </kendo-grid-column>
    <kendo-grid-column field="telephone" title="{{language.telephone}}">
    </kendo-grid-column>
    <kendo-grid-column field="mobile" title="{{language.mobile}}">
    </kendo-grid-column>
    <kendo-grid-column field="email" title="{{language.email}}">
    </kendo-grid-column>
    <kendo-grid-column title="{{language.preview}}" width="100">
      <ng-template kendoGridCellTemplate let-dataItem>
        <button kendoButton [icon]="'k-icon k-i-preview'" class='k-preview' (click)="previewUser(dataItem)"></button>
      </ng-template>
    </kendo-grid-column>

    <kendo-grid-pdf fileName="Customers.pdf" [allPages]="true" paperSize="A4" [repeatHeaders]="true">
      <kendo-grid-pdf-margin top="2cm" left="1cm" right="1cm" bottom="2cm"></kendo-grid-pdf-margin>
      <ng-template kendoGridPDFTemplate let-pageNum="pageNum" let-totalPages="totalPages">
        <div class="page-template">
          <div class="header">
            <div>{{language.pagerPage}} {{ pageNum }} {{language.pagerOf}} {{ totalPages }}</div>
          </div>
        </div>
      </ng-template>
      <kendo-grid-column field="shortname" title="{{language.username}}">
      </kendo-grid-column>
      <kendo-grid-column field="firstname" title="{{language.firstname}}">
      </kendo-grid-column>
      <kendo-grid-column field="lastname" title="{{language.lastname}}">
      </kendo-grid-column>
      <kendo-grid-column field="telephone" title="{{language.telephone}}">
      </kendo-grid-column>
      <kendo-grid-column field="mobile" title="{{language.mobile}}">
      </kendo-grid-column>
    </kendo-grid-pdf>
    <kendo-grid-excel fileName="Customers.xlsx"></kendo-grid-excel>
    <ng-template kendoGridNoRecordsTemplate>
      <div class="row no-results-element">
        <div class="text-center">
          <i class="fa fa-heartbeat no-results-icon"></i><br>
        </div>
        <div class="text-center m-t-md">
          <p class="m-b-none">
            You have no records yet! Let's start with adding records. </p>
        </div>
      </div>
    </ng-template>
  </kendo-grid>

  <kendo-dialog title="Please confirm" *ngIf="customerDialogOpened" (close)="close('dialog')" [minWidth]="250"
    [width]="450">
    <p style="margin: 30px; text-align: center;">Are you sure you want to import data from excel?</p>
    <kendo-dialog-actions>
      <button kendoButton (click)="action('no')">No</button>
      <button kendoButton (click)="action('yes')" primary="true">Yes</button>
    </kendo-dialog-actions>
  </kendo-dialog>
</div>

<kendo-window title="{{language.createNewCustomer}}" *ngIf="customer" [minWidth]="700" [width]="850" [height]="670"
  (close)="closeCustomer()">
  <form name="loginForm" class="loginForm" (ngSubmit)="createCustomer(customer)" #customerForm="ngForm">
    <div class="form-group">
      <div class="panel-body">
        <div class="text-center vd_info-parent col-md-4 col-xs-12">
          <img *ngIf="data.gender === ''" alt="example image" style="width: 190px;"
            src="../../../../assets/images/users/{{imagePath}}.png" class="rounded-circle">
          <img *ngIf="data.gender !== '' && data.gender === 'male'" alt="example image" style="width: 190px;"
            src="../../../../assets/images/users/male-patient.png" class="rounded-circle">
          <img *ngIf="data.gender !== '' && data.gender === 'female'" alt="example image" style="width: 190px;"
            src="../../../../assets/images/users/female-patient.png" class="rounded-circle">
          <h2 class="font-semibold">{{data.firstname}} {{data.lastname}}</h2>
        </div>
        <div class="col-md-8 col-xs-12">
          <div class="col-sm-6" style="margin-bottom: 3vh;">
            <div class="row mgbt-xs-0">
              <kendo-textbox-container floatingLabel="{{language.attention}}">
                <textarea kendoTextArea [(ngModel)]="data.attention" [autoSize]="true" name="attention"
                  style="width: 95%;"></textarea>
              </kendo-textbox-container>
            </div>
          </div>
          <div class="col-sm-6" style="margin-bottom: 3vh;">
            <div class="row mgbt-xs-0">
              <kendo-textbox-container floatingLabel="{{language.physicalComplaint}}">
                <textarea kendoTextArea [(ngModel)]="data.physicalComplaint" [autoSize]="true" name="physicalComplaint"
                  style="width: 95%;"></textarea>
              </kendo-textbox-container>
            </div>
          </div>
          <div>
            <kendo-textbox-container floatingLabel="{{language.firstname}}({{language.required}})">
              <input kendoTextBox [(ngModel)]="data.firstname" name="firstname" class="noPadding" required
                #firstname="ngModel">
            </kendo-textbox-container>
          </div>
          <div>
            <kendo-textbox-container floatingLabel="{{language.lastname}}({{language.required}})">
              <input kendoTextBox [(ngModel)]="data.lastname" name="lastname" class="noPadding" required
                #lastname="ngModel">
            </kendo-textbox-container>
          </div>
          <div class="form-group col-md-12 col-xs-12">
            <div class="col-md-6 col-xs-12">
              <!--<kendo-textbox-container floatingLabel="{{language.gender}}">
                <div style="padding-left: 45px;">
                  <input type="radio" name="gender" id="female" class="k-radio"
                    checked="data.gender === 'female' ? checked : ''" [(ngModel)]="data.gender" [value]="'female'">
                  <span class="k-radio-label col-md-6 col-xs-12" for="female">{{language.female}}</span>
                </div>
                <div style="padding-left: 45px;">
                  <input type="radio" name="gender" id="male" class="k-radio"
                    checked="data.gender === 'male' ? checked : ''" [(ngModel)]="data.gender" [value]="'male'">
                  <span class="k-radio-label col-md-6 col-xs-12" for="male">{{language.male}}</span>
                </div>
              </kendo-textbox-container>
              -->
              <p>{{language.gender}}</p>
              <label class="k-radio-label col-md-6 col-xs-12" for="female">
                <input type="radio" name="gender" id="female" class="k-radio"
                  checked="data.gender === 'female' ? checked : ''" [(ngModel)]="data.gender" [value]="'female'">
                {{language.female}}</label>
              <label class="k-radio-label col-md-6 col-xs-12" for="male">
                <input type="radio" name="gender" id="male" class="k-radio"
                  checked="data.gender === 'male' ? checked : ''" [(ngModel)]="data.gender" [value]="'male'">
                {{language.male}}</label>
            </div>
            <div class="birthday-container col-md-6 col-xs-12">
              <kendo-textbox-container floatingLabel="{{language.birthday}}">
                <kendo-datepicker class="email noPadding" name="birthday" [(ngModel)]="data.birthday"
                  (valueChange)="onChange($event)">
                </kendo-datepicker>
              </kendo-textbox-container>
            </div>
          </div>

        </div>
      </div>
    </div>
    <div class="form-group">
      <div class="email col-md-4 col-xs-12">
        <kendo-textbox-container floatingLabel="{{language.telephone}}">
          <input kendoTextBox type="text" class="col-xs-12" name="telephone" [(ngModel)]="data.telephone"
            telephone.value=''>
        </kendo-textbox-container>
      </div>
      <div class="email col-md-4 col-xs-12">
        <kendo-textbox-container floatingLabel="{{language.mobile}}">
          <input kendoTextBox type="text" class="col-xs-12" name="mobile" [(ngModel)]="data.mobile" mobile.value=''>
        </kendo-textbox-container>
      </div>
      <div class="email col-md-4 col-xs-12">
        <kendo-textbox-container floatingLabel="{{language.email}}({{language.required}})">
          <input kendoTextBox type="email" class="col-xs-12" name="email" [(ngModel)]="data.email"
            [pattern]="emailPattern" #email="ngModel" required #email="ngModel"></kendo-textbox-container>
      </div>
      <div class="email col-md-4 col-xs-12">
        <kendo-textbox-container floatingLabel="{{language.street}}">
          <input kendoTextBox type="text" class="col-xs-12" [(ngModel)]="data.street" name="street">
        </kendo-textbox-container>
      </div>
      <div class="email col-md-4 col-xs-12">
        <kendo-textbox-container floatingLabel="{{language.streetnumber}}">
          <input kendoTextBox type="text" class="col-xs-12" [(ngModel)]="data.streetnumber" name="streetnumber">
        </kendo-textbox-container>
      </div>
      <div class="email col-md-4 col-xs-12">
        <kendo-textbox-container floatingLabel="{{language.city}}">
          <input kendoTextBox type="text" class="col-xs-12" [(ngModel)]="data.city" name="city">
        </kendo-textbox-container>
      </div>
    </div>
    <!-- ./remember-row -->
    <div class="form-group" style="text-align: center">
      <button kendoButton [disabled]="customerForm.form.invalid" [primary]="true" [primary]="true" class="form-button"
        type="submit">{{language.createNewCustomer}}</button>
    </div>
  </form>
</kendo-window>

<!--<kendo-upload [saveUrl]="uploadSaveUrl" [removeUrl]="uploadRemoveUrl" [autoUpload]="false">

</kendo-upload>-->
<app-base-date *ngIf="selectedUser !== undefined" [data]="selectedUser" [type]="'details'"></app-base-date>